!function(root,factory){"object"==typeof exports&&"object"==typeof module?module.exports=factory(require("js-sha256"),require("base64-js")):"function"==typeof define&&define.amd?define("keycloak",["js-sha256","base64-js"],factory):"object"==typeof exports?exports.keycloak=factory(require("js-sha256"),require("base64-js")):(function(){"use strict";function t(e,t){t?(d[0]=d[16]=d[1]=d[2]=d[3]=d[4]=d[5]=d[6]=d[7]=d[8]=d[9]=d[10]=d[11]=d[12]=d[13]=d[14]=d[15]=0,this.blocks=d):this.blocks=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],e?(this.h0=3238371032,this.h1=914150663,this.h2=812702999,this.h3=4144912697,this.h4=4290775857,this.h5=1750603025,this.h6=1694076839,this.h7=3204075428):(this.h0=1779033703,this.h1=3144134277,this.h2=1013904242,this.h3=2773480762,this.h4=1359893119,this.h5=2600822924,this.h6=528734635,this.h7=1541459225),this.block=this.start=this.bytes=this.hBytes=0,this.finalized=this.hashed=!1,this.first=!0,this.is224=e}function i(e,r,n){var o,i=typeof e;if("string"==i){var s,a=[],c=e.length,u=0;for(o=0;o<c;++o)(s=e.charCodeAt(o))<128?a[u++]=s:(s<2048?a[u++]=192|s>>6:(s<55296||57344<=s?a[u++]=224|s>>12:(s=65536+((1023&s)<<10|1023&e.charCodeAt(++o)),a[u++]=240|s>>18,a[u++]=128|s>>12&63),a[u++]=128|s>>6&63),a[u++]=128|63&s);e=a}else{if("object"!=i)throw new Error(h);if(null===e)throw new Error(h);if(f&&e.constructor===ArrayBuffer)e=new Uint8Array(e);else if(!(Array.isArray(e)||f&&ArrayBuffer.isView(e)))throw new Error(h)}64<e.length&&(e=new t(r,!0).update(e).array());var d=[],l=[];for(o=0;o<64;++o){var p=e[o]||0;d[o]=92^p,l[o]=54^p}t.call(this,r,n),this.update(l),this.oKeyPad=d,this.inner=!0,this.sharedMemory=n}var h="input is invalid type",r="object"==typeof window,s=r?window:{};s.JS_SHA256_NO_WINDOW&&(r=!1);var e=!r&&"object"==typeof self,n=!s.JS_SHA256_NO_NODE_JS&&"object"==typeof process&&process.versions&&process.versions.node;n?s=global:e&&(s=self);var o=!s.JS_SHA256_NO_COMMON_JS&&"object"==typeof module&&module.exports,a="function"==typeof define&&define.amd,f=!s.JS_SHA256_NO_ARRAY_BUFFER&&"undefined"!=typeof ArrayBuffer,u="0123456789abcdef".split(""),c=[-2147483648,8388608,32768,128],y=[24,16,8,0],p=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298],l=["hex","array","digest","arrayBuffer"],d=[];!s.JS_SHA256_NO_NODE_JS&&Array.isArray||(Array.isArray=function(e){return"[object Array]"===Object.prototype.toString.call(e)}),!f||!s.JS_SHA256_NO_ARRAY_BUFFER_IS_VIEW&&ArrayBuffer.isView||(ArrayBuffer.isView=function(e){return"object"==typeof e&&e.buffer&&e.buffer.constructor===ArrayBuffer});var A=function(r,n){return function(e){return new t(n,!0).update(e)[r]()}},w=function(e){var r=A("hex",e);n&&(r=b(r,e)),r.create=function(){return new t(e)},r.update=function(e){return r.create().update(e)};for(var o=0;o<l.length;++o){var i=l[o];r[i]=A(i,e)}return r},b=function(t,i){var r=eval("require('crypto')"),s=eval("require('buffer').Buffer"),e=i?"sha224":"sha256",n=function(n){if("string"==typeof n)return r.createHash(e).update(n,"utf8").digest("hex");if(null==n)throw new Error(h);return n.constructor===ArrayBuffer&&(n=new Uint8Array(n)),Array.isArray(n)||ArrayBuffer.isView(n)||n.constructor===s?r.createHash(e).update(new s(n)).digest("hex"):t(n)};return n},v=function(r,n){return function(e,t){return new i(e,n,!0).update(t)[r]()}},_=function(t){var r=v("hex",t);r.create=function(e){return new i(e,t)},r.update=function(e,t){return r.create(e).update(t)};for(var e=0;e<l.length;++e){var n=l[e];r[n]=v(n,t)}return r};t.prototype.update=function(e){if(!this.finalized){var t,r=typeof e;if("string"!=r){if("object"!=r)throw new Error(h);if(null===e)throw new Error(h);if(f&&e.constructor===ArrayBuffer)e=new Uint8Array(e);else if(!(Array.isArray(e)||f&&ArrayBuffer.isView(e)))throw new Error(h);t=!0}for(var n,o,i=0,s=e.length,a=this.blocks;i<s;){if(this.hashed&&(this.hashed=!1,a[0]=this.block,a[16]=a[1]=a[2]=a[3]=a[4]=a[5]=a[6]=a[7]=a[8]=a[9]=a[10]=a[11]=a[12]=a[13]=a[14]=a[15]=0),t)for(o=this.start;i<s&&o<64;++i)a[o>>2]|=e[i]<<y[3&o++];else for(o=this.start;i<s&&o<64;++i)(n=e.charCodeAt(i))<128?a[o>>2]|=n<<y[3&o++]:(n<2048?a[o>>2]|=(192|n>>6)<<y[3&o++]:(n<55296||57344<=n?a[o>>2]|=(224|n>>12)<<y[3&o++]:(n=65536+((1023&n)<<10|1023&e.charCodeAt(++i)),a[o>>2]|=(240|n>>18)<<y[3&o++],a[o>>2]|=(128|n>>12&63)<<y[3&o++]),a[o>>2]|=(128|n>>6&63)<<y[3&o++]),a[o>>2]|=(128|63&n)<<y[3&o++]);this.lastByteIndex=o,this.bytes+=o-this.start,64<=o?(this.block=a[16],this.start=o-64,this.hash(),this.hashed=!0):this.start=o}return 4294967295<this.bytes&&(this.hBytes+=this.bytes/4294967296<<0,this.bytes=this.bytes%4294967296),this}},t.prototype.finalize=function(){if(!this.finalized){this.finalized=!0;var e=this.blocks,t=this.lastByteIndex;e[16]=this.block,e[t>>2]|=c[3&t],this.block=e[16],56<=t&&(this.hashed||this.hash(),e[0]=this.block,e[16]=e[1]=e[2]=e[3]=e[4]=e[5]=e[6]=e[7]=e[8]=e[9]=e[10]=e[11]=e[12]=e[13]=e[14]=e[15]=0),e[14]=this.hBytes<<3|this.bytes>>>29,e[15]=this.bytes<<3,this.hash()}},t.prototype.hash=function(){var e,t,r,n,o,i,s,a,c,u=this.h0,d=this.h1,l=this.h2,f=this.h3,h=this.h4,m=this.h5,k=this.h6,v=this.h7,w=this.blocks;for(e=16;e<64;++e)t=((o=w[e-15])>>>7|o<<25)^(o>>>18|o<<14)^o>>>3,r=((o=w[e-2])>>>17|o<<15)^(o>>>19|o<<13)^o>>>10,w[e]=w[e-16]+t+w[e-7]+r<<0;for(c=d&l,e=0;e<64;e+=4)this.first?(f=this.is224?(i=300032,v=(o=w[0]-1413257819)-150054599<<0,o+24177077<<0):(i=704751109,v=(o=w[0]-210244248)-1521486534<<0,o+143694565<<0),this.first=!1):(t=(u>>>2|u<<30)^(u>>>13|u<<19)^(u>>>22|u<<10),n=(i=u&d)^u&l^c,v=f+(o=v+(r=(h>>>6|h<<26)^(h>>>11|h<<21)^(h>>>25|h<<7))+(h&m^~h&k)+p[e]+w[e])<<0,f=o+(t+n)<<0),t=(f>>>2|f<<30)^(f>>>13|f<<19)^(f>>>22|f<<10),n=(s=f&u)^f&d^i,k=l+(o=k+(r=(v>>>6|v<<26)^(v>>>11|v<<21)^(v>>>25|v<<7))+(v&h^~v&m)+p[e+1]+w[e+1])<<0,t=((l=o+(t+n)<<0)>>>2|l<<30)^(l>>>13|l<<19)^(l>>>22|l<<10),n=(a=l&f)^l&u^s,m=d+(o=m+(r=(k>>>6|k<<26)^(k>>>11|k<<21)^(k>>>25|k<<7))+(k&v^~k&h)+p[e+2]+w[e+2])<<0,t=((d=o+(t+n)<<0)>>>2|d<<30)^(d>>>13|d<<19)^(d>>>22|d<<10),n=(c=d&l)^d&f^a,h=u+(o=h+(r=(m>>>6|m<<26)^(m>>>11|m<<21)^(m>>>25|m<<7))+(m&k^~m&v)+p[e+3]+w[e+3])<<0,u=o+(t+n)<<0;this.h0=this.h0+u<<0,this.h1=this.h1+d<<0,this.h2=this.h2+l<<0,this.h3=this.h3+f<<0,this.h4=this.h4+h<<0,this.h5=this.h5+m<<0,this.h6=this.h6+k<<0,this.h7=this.h7+v<<0},t.prototype.hex=function(){this.finalize();var e=this.h0,t=this.h1,r=this.h2,n=this.h3,o=this.h4,i=this.h5,s=this.h6,a=this.h7,c=u[e>>28&15]+u[e>>24&15]+u[e>>20&15]+u[e>>16&15]+u[e>>12&15]+u[e>>8&15]+u[e>>4&15]+u[15&e]+u[t>>28&15]+u[t>>24&15]+u[t>>20&15]+u[t>>16&15]+u[t>>12&15]+u[t>>8&15]+u[t>>4&15]+u[15&t]+u[r>>28&15]+u[r>>24&15]+u[r>>20&15]+u[r>>16&15]+u[r>>12&15]+u[r>>8&15]+u[r>>4&15]+u[15&r]+u[n>>28&15]+u[n>>24&15]+u[n>>20&15]+u[n>>16&15]+u[n>>12&15]+u[n>>8&15]+u[n>>4&15]+u[15&n]+u[o>>28&15]+u[o>>24&15]+u[o>>20&15]+u[o>>16&15]+u[o>>12&15]+u[o>>8&15]+u[o>>4&15]+u[15&o]+u[i>>28&15]+u[i>>24&15]+u[i>>20&15]+u[i>>16&15]+u[i>>12&15]+u[i>>8&15]+u[i>>4&15]+u[15&i]+u[s>>28&15]+u[s>>24&15]+u[s>>20&15]+u[s>>16&15]+u[s>>12&15]+u[s>>8&15]+u[s>>4&15]+u[15&s];return this.is224||(c+=u[a>>28&15]+u[a>>24&15]+u[a>>20&15]+u[a>>16&15]+u[a>>12&15]+u[a>>8&15]+u[a>>4&15]+u[15&a]),c},t.prototype.toString=t.prototype.hex,t.prototype.digest=function(){this.finalize();var e=this.h0,t=this.h1,r=this.h2,n=this.h3,o=this.h4,i=this.h5,s=this.h6,a=this.h7,c=[e>>24&255,e>>16&255,e>>8&255,255&e,t>>24&255,t>>16&255,t>>8&255,255&t,r>>24&255,r>>16&255,r>>8&255,255&r,n>>24&255,n>>16&255,n>>8&255,255&n,o>>24&255,o>>16&255,o>>8&255,255&o,i>>24&255,i>>16&255,i>>8&255,255&i,s>>24&255,s>>16&255,s>>8&255,255&s];return this.is224||c.push(a>>24&255,a>>16&255,a>>8&255,255&a),c},t.prototype.array=t.prototype.digest,t.prototype.arrayBuffer=function(){this.finalize();var e=new ArrayBuffer(this.is224?28:32),t=new DataView(e);return t.setUint32(0,this.h0),t.setUint32(4,this.h1),t.setUint32(8,this.h2),t.setUint32(12,this.h3),t.setUint32(16,this.h4),t.setUint32(20,this.h5),t.setUint32(24,this.h6),this.is224||t.setUint32(28,this.h7),e},i.prototype=new t,i.prototype.finalize=function(){if(t.prototype.finalize.call(this),this.inner){this.inner=!1;var e=this.array();t.call(this,this.is224,this.sharedMemory),this.update(this.oKeyPad),this.update(e),t.prototype.finalize.call(this)}};var B=w();B.sha256=B,B.sha224=w(!0),B.sha256.hmac=_(),B.sha224.hmac=_(!0),o?module.exports=B:(s.sha256=B.sha256,s.sha224=B.sha224,a&&define(function(){return B}))}(),function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).base64js=e()}}(function(){return function i(s,a,c){function u(t,e){if(!a[t]){if(!s[t]){var r="function"==typeof require&&require;if(!e&&r)return r(t,!0);if(d)return d(t,!0);var n=new Error("Cannot find module '"+t+"'");throw n.code="MODULE_NOT_FOUND",n}var o=a[t]={exports:{}};s[t][0].call(o.exports,function(e){return u(s[t][1][e]||e)},o,o.exports,i,s,a,c)}return a[t].exports}for(var d="function"==typeof require&&require,e=0;e<c.length;e++)u(c[e]);return u}({"/":[function(e,t,r){"use strict";r.byteLength=function(e){var t=l(e),r=t[0],n=t[1];return 3*(r+n)/4-n},r.toByteArray=function(e){for(var t,r=l(e),n=r[0],o=r[1],i=new d(function(e,t,r){return 3*(t+r)/4-r}(0,n,o)),s=0,a=0<o?n-4:n,c=0;c<a;c+=4)t=u[e.charCodeAt(c)]<<18|u[e.charCodeAt(c+1)]<<12|u[e.charCodeAt(c+2)]<<6|u[e.charCodeAt(c+3)],i[s++]=t>>16&255,i[s++]=t>>8&255,i[s++]=255&t;2===o&&(t=u[e.charCodeAt(c)]<<2|u[e.charCodeAt(c+1)]>>4,i[s++]=255&t);1===o&&(t=u[e.charCodeAt(c)]<<10|u[e.charCodeAt(c+1)]<<4|u[e.charCodeAt(c+2)]>>2,i[s++]=t>>8&255,i[s++]=255&t);return i},r.fromByteArray=function(e){for(var t,r=e.length,n=r%3,o=[],i=0,s=r-n;i<s;i+=16383)o.push(c(e,i,s<i+16383?s:i+16383));1==n?(t=e[r-1],o.push(a[t>>2]+a[t<<4&63]+"==")):2==n&&(t=(e[r-2]<<8)+e[r-1],o.push(a[t>>10]+a[t>>4&63]+a[t<<2&63]+"="));return o.join("")};for(var a=[],u=[],d="undefined"!=typeof Uint8Array?Uint8Array:Array,n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",o=0,i=n.length;o<i;++o)a[o]=n[o],u[n.charCodeAt(o)]=o;function l(e){var t=e.length;if(0<t%4)throw new Error("Invalid string. Length must be a multiple of 4");var r=e.indexOf("=");return-1===r&&(r=t),[r,r===t?0:4-r%4]}function c(e,t,r){for(var n,o,i=[],s=t;s<r;s+=3)n=(e[s]<<16&16711680)+(e[s+1]<<8&65280)+(255&e[s+2]),i.push(a[(o=n)>>18&63]+a[o>>12&63]+a[o>>6&63]+a[63&o]);return i.join("")}u["-".charCodeAt(0)]=62,u["_".charCodeAt(0)]=63},{}]},{},[])("/")}),root.Keycloak=factory(root.sha256,root.base64js))}(window,function(I,E){return function e(c){if(!(this instanceof e))return new e(c);for(var u,d,l=this,a=[],f={enable:!0,callbackList:[],interval:5},t=document.getElementsByTagName("script"),r=0;r<t.length;r++)-1===t[r].src.indexOf("keycloak.js")&&-1===t[r].src.indexOf("keycloak.min.js")||-1===t[r].src.indexOf("version=")||(l.iframeVersion=t[r].src.substring(t[r].src.indexOf("version=")+8).split("&")[0]);var h=!0;function p(e,t){for(var r=function(e){var t=null,r=window.crypto||window.msCrypto;if(r&&r.getRandomValues&&window.Uint8Array)return t=new Uint8Array(e),r.getRandomValues(t),t;t=new Array(e);for(var n=0;n<t.length;n++)t[n]=Math.floor(256*Math.random());return t}(e),n=new Array(e),o=0;o<e;o++)n[o]=t.charCodeAt(r[o]%t.length);return String.fromCharCode.apply(null,n)}function m(){return void 0!==l.authServerUrl?"/"==l.authServerUrl.charAt(l.authServerUrl.length-1)?l.authServerUrl+"realms/"+encodeURIComponent(l.realm):l.authServerUrl+"/realms/"+encodeURIComponent(l.realm):void 0}function k(o,i){var e=o.code,t=o.error,r=o.prompt,s=(new Date).getTime();if(t)if("none"!=r){var n={error:t,error_description:o.error_description};l.onAuthError&&l.onAuthError(n),i&&i.setError(n)}else i&&i.setSuccess();else if("standard"!=l.flow&&(o.access_token||o.id_token)&&d(o.access_token,null,o.id_token,!0),"implicit"!=l.flow&&e){var a="code="+e+"&grant_type=authorization_code",c=l.endpoints.token(),u=new XMLHttpRequest;u.open("POST",c,!0),u.setRequestHeader("Content-type","application/x-www-form-urlencoded"),l.clientId&&l.clientSecret?u.setRequestHeader("Authorization","Basic "+btoa(l.clientId+":"+l.clientSecret)):a+="&client_id="+encodeURIComponent(l.clientId),a+="&redirect_uri="+o.redirectUri,o.pkceCodeVerifier&&(a+="&code_verifier="+o.pkceCodeVerifier),u.withCredentials=!0,u.onreadystatechange=function(){if(4==u.readyState)if(200==u.status){var e=JSON.parse(u.responseText);d(e.access_token,e.refresh_token,e.id_token,"standard"===l.flow),A()}else l.onAuthError&&l.onAuthError(),i&&i.setError()},u.send(a)}function d(e,t,r,n){w(e,t,r,s=(s+(new Date).getTime())/2),h&&(l.tokenParsed&&l.tokenParsed.nonce!=o.storedNonce||l.refreshTokenParsed&&l.refreshTokenParsed.nonce!=o.storedNonce||l.idTokenParsed&&l.idTokenParsed.nonce!=o.storedNonce)?(console.info("[KEYCLOAK] Invalid nonce, clearing token"),l.clearToken(),i&&i.setError()):n&&(l.onAuthSuccess&&l.onAuthSuccess(),i&&i.setSuccess())}}function v(e){return 0==e.status&&e.responseText&&e.responseURL.startsWith("file:")}function w(e,t,r,n){if(l.tokenTimeoutHandle&&(clearTimeout(l.tokenTimeoutHandle),l.tokenTimeoutHandle=null),t?(l.refreshToken=t,l.refreshTokenParsed=i(t)):(delete l.refreshToken,delete l.refreshTokenParsed),r?(l.idToken=r,l.idTokenParsed=i(r)):(delete l.idToken,delete l.idTokenParsed),e){if(l.token=e,l.tokenParsed=i(e),l.sessionId=l.tokenParsed.session_state,l.authenticated=!0,l.subject=l.tokenParsed.sub,l.realmAccess=l.tokenParsed.realm_access,l.resourceAccess=l.tokenParsed.resource_access,n&&(l.timeSkew=Math.floor(n/1e3)-l.tokenParsed.iat),null!=l.timeSkew&&(console.info("[KEYCLOAK] Estimated time difference between browser and server is "+l.timeSkew+" seconds"),l.onTokenExpired)){var o=1e3*(l.tokenParsed.exp-(new Date).getTime()/1e3+l.timeSkew);console.info("[KEYCLOAK] Token expires in "+Math.round(o/1e3)+" s"),o<=0?l.onTokenExpired():l.tokenTimeoutHandle=setTimeout(l.onTokenExpired,o)}}else delete l.token,delete l.tokenParsed,delete l.subject,delete l.realmAccess,delete l.resourceAccess,l.authenticated=!1}function i(e){switch((e=(e=(e=e.split(".")[1]).replace("/-/g","+")).replace("/_/g","/")).length%4){case 0:break;case 2:e+="==";break;case 3:e+="=";break;default:throw"Invalid token"}return e=(e=(e+"===").slice(0,e.length+e.length%4)).replace(/-/g,"+").replace(/_/g,"/"),e=decodeURIComponent(escape(atob(e))),e=JSON.parse(e)}function g(){var e="0123456789abcdef",t=p(36,e).split("");return t[14]="4",t[19]=e.substr(3&t[19]|8,1),t[8]=t[13]=t[18]=t[23]="-",t.join("")}function y(e){var t=function(e){var t;switch(l.flow){case"standard":t=["code","state","session_state"];break;case"implicit":t=["access_token","token_type","id_token","state","session_state","expires_in"];break;case"hybrid":t=["access_token","id_token","code","state","session_state"]}t.push("error"),t.push("error_description"),t.push("error_uri");var r,n,o=e.indexOf("?"),i=e.indexOf("#");if("query"===l.responseMode&&-1!==o?(r=e.substring(0,o),""!==(n=s(e.substring(o+1,-1!==i?i:e.length),t)).paramsString&&(r+="?"+n.paramsString),-1!==i&&(r+=e.substring(i))):"fragment"===l.responseMode&&-1!==i&&(r=e.substring(0,i),""!==(n=s(e.substring(i+1),t)).paramsString&&(r+="#"+n.paramsString)),n&&n.oauthParams)if("standard"===l.flow||"hybrid"===l.flow){if((n.oauthParams.code||n.oauthParams.error)&&n.oauthParams.state)return n.oauthParams.newUrl=r,n.oauthParams}else if("implicit"===l.flow&&(n.oauthParams.access_token||n.oauthParams.error)&&n.oauthParams.state)return n.oauthParams.newUrl=r,n.oauthParams}(e);if(t){var r=d.get(t.state);return r&&(t.valid=!0,t.redirectUri=r.redirectUri,t.storedNonce=r.nonce,t.prompt=r.prompt,t.pkceCodeVerifier=r.pkceCodeVerifier),t}}function s(e,t){for(var r=e.split("&"),n={paramsString:"",oauthParams:{}},o=0;o<r.length;o++){var i=r[o].split("=");-1!==t.indexOf(i[0])?n.oauthParams[i[0]]=i[1]:(""!==n.paramsString&&(n.paramsString+="&"),n.paramsString+=r[o])}return n}function b(e){return!e&&l.useNativePromise?function(){var r={setSuccess:function(e){r.resolve(e)},setError:function(e){r.reject(e)}};return r.promise=new Promise(function(e,t){r.resolve=e,r.reject=t}),r.promise.success=function(e){return r.resolve(e),r.promise},r.promise.error=function(e){return r.reject(e),r.promise},r}():function(){var t={setSuccess:function(e){t.success=!0,t.result=e,t.successCallback&&t.successCallback(e)},setError:function(e){t.error=!0,t.result=e,t.errorCallback&&t.errorCallback(e)},promise:{success:function(e){return t.success?e(t.result):t.error||(t.successCallback=e),t.promise},error:function(e){return t.error?e(t.result):t.success||(t.errorCallback=e),t.promise}}};return t}()}function S(){var t=b(!0);if(!f.enable)return t.setSuccess(),t.promise;if(f.iframe)return t.setSuccess(),t.promise;var e=document.createElement("iframe");(f.iframe=e).onload=function(){var e=l.endpoints.authorize();"/"===e.charAt(0)?f.iframeOrigin=window.location.origin?window.location.origin:window.location.protocol+"//"+window.location.hostname+(window.location.port?":"+window.location.port:""):f.iframeOrigin=e.substring(0,e.indexOf("/",8)),t.setSuccess()};var r=l.endpoints.checkSessionIframe();return e.setAttribute("src",r),e.setAttribute("title","keycloak-session-iframe"),e.style.display="none",document.body.appendChild(e),window.addEventListener("message",function(e){if(e.origin===f.iframeOrigin&&f.iframe.contentWindow===e.source&&("unchanged"==e.data||"changed"==e.data||"error"==e.data)){"unchanged"!=e.data&&l.clearToken();for(var t=f.callbackList.splice(0,f.callbackList.length),r=t.length-1;0<=r;--r){var n=t[r];"error"==e.data?n.setError():n.setSuccess("unchanged"==e.data)}}},!1),t.promise}function A(){f.enable&&l.token&&setTimeout(function(){U().success(function(e){e&&A()})},1e3*f.interval)}function U(){var e=b(!0);if(f.iframe&&f.iframeOrigin){var t=l.clientId+" "+(l.sessionId?l.sessionId:"");f.callbackList.push(e);var r=f.iframeOrigin;1==f.callbackList.length&&f.iframe.contentWindow.postMessage(t,r)}else e.setSuccess();return e.promise}function n(e){if(!e||"default"==e)return{login:function(e){return window.location.replace(l.createLoginUrl(e)),b().promise},logout:function(e){return window.location.replace(l.createLogoutUrl(e)),b().promise},register:function(e){return window.location.replace(l.createRegisterUrl(e)),b().promise},accountManagement:function(){var e=l.createAccountUrl();if(void 0===e)throw"Not supported by the OIDC server";return window.location.href=e,b(!1).promise},redirectUri:function(e,t){return 1==arguments.length&&(t=!0),e&&e.redirectUri?e.redirectUri:l.redirectUri?l.redirectUri:location.href}};if("cordova"==e){function c(e,t,r){return window.cordova&&window.cordova.InAppBrowser?window.cordova.InAppBrowser.open(e,t,r):window.open(e,t,r)}function u(e){var t=function(r){return r&&r.cordovaOptions?Object.keys(r.cordovaOptions).reduce(function(e,t){return e[t]=r.cordovaOptions[t],e},{}):{}}(e);return t.location="no",e&&"none"==e.prompt&&(t.hidden="yes"),function(r){return Object.keys(r).reduce(function(e,t){return e.push(t+"="+r[t]),e},[]).join(",")}(t)}return f.enable=!1,{login:function(e){function t(){a=!0,i.close()}var r=b(!1),n=u(e),o=l.createLoginUrl(e),i=c(o,"_blank",n),s=!1,a=!1;return i.addEventListener("loadstart",function(e){0==e.url.indexOf("http://localhost")&&(k(y(e.url),r),t(),s=!0)}),i.addEventListener("loaderror",function(e){s||(0==e.url.indexOf("http://localhost")?(k(y(e.url),r),t(),s=!0):(r.setError(),t()))}),i.addEventListener("exit",function(e){a||r.setError({reason:"closed_by_user"})}),r.promise},logout:function(e){var t,r=b(!1),n=l.createLogoutUrl(e),o=c(n,"_blank","location=no,hidden=yes");return o.addEventListener("loadstart",function(e){0==e.url.indexOf("http://localhost")&&o.close()}),o.addEventListener("loaderror",function(e){0==e.url.indexOf("http://localhost")||(t=!0),o.close()}),o.addEventListener("exit",function(e){t?r.setError():(l.clearToken(),r.setSuccess())}),r.promise},register:function(e){var t=b(!1),r=l.createRegisterUrl(),n=u(e),o=c(r,"_blank",n);return o.addEventListener("loadstart",function(e){0==e.url.indexOf("http://localhost")&&(o.close(),k(y(e.url),t))}),t.promise},accountManagement:function(){var e=l.createAccountUrl();if(void 0===e)throw"Not supported by the OIDC server";var t=c(e,"_blank","location=no");t.addEventListener("loadstart",function(e){0==e.url.indexOf("http://localhost")&&t.close()})},redirectUri:function(e){return"http://localhost"}}}if("cordova-native"==e)return f.enable=!1,{login:function(e){var t=b(!1),r=l.createLoginUrl(e);return universalLinks.subscribe("keycloak",function(e){universalLinks.unsubscribe("keycloak"),window.cordova.plugins.browsertab.close(),k(y(e.url),t)}),window.cordova.plugins.browsertab.openUrl(r),t.promise},logout:function(e){var t=b(!1),r=l.createLogoutUrl(e);return universalLinks.subscribe("keycloak",function(e){universalLinks.unsubscribe("keycloak"),window.cordova.plugins.browsertab.close(),l.clearToken(),t.setSuccess()}),window.cordova.plugins.browsertab.openUrl(r),t.promise},register:function(e){var t=b(!1),r=l.createRegisterUrl(e);return universalLinks.subscribe("keycloak",function(e){universalLinks.unsubscribe("keycloak"),window.cordova.plugins.browsertab.close(),k(y(e.url),t)}),window.cordova.plugins.browsertab.openUrl(r),t.promise},accountManagement:function(){var e=l.createAccountUrl();if(void 0===e)throw"Not supported by the OIDC server";window.cordova.plugins.browsertab.openUrl(e)},redirectUri:function(e){return e&&e.redirectUri?e.redirectUri:l.redirectUri?l.redirectUri:"http://localhost"}};throw"invalid adapter type: "+e}l.init=function(o){if(l.authenticated=!1,d=function(){try{return new _}catch(e){}return new C}(),u=o&&-1<["default","cordova","cordova-native"].indexOf(o.adapter)?n(o.adapter):o&&"object"==typeof o.adapter?o.adapter:window.Cordova||window.cordova?n("cordova"):n(),o){if(void 0!==o.useNonce&&(h=o.useNonce),void 0!==o.checkLoginIframe&&(f.enable=o.checkLoginIframe),o.checkLoginIframeInterval&&(f.interval=o.checkLoginIframeInterval),"native"===o.promiseType?l.useNativePromise="function"==typeof Promise:l.useNativePromise=!1,"login-required"===o.onLoad&&(l.loginRequired=!0),o.responseMode){if("query"!==o.responseMode&&"fragment"!==o.responseMode)throw"Invalid value for responseMode";l.responseMode=o.responseMode}if(o.flow){switch(o.flow){case"standard":l.responseType="code";break;case"implicit":l.responseType="id_token token";break;case"hybrid":l.responseType="code id_token token";break;default:throw"Invalid value for flow"}l.flow=o.flow}if(null!=o.timeSkew&&(l.timeSkew=o.timeSkew),o.redirectUri&&(l.redirectUri=o.redirectUri),o.silentCheckSsoRedirectUri&&(l.silentCheckSsoRedirectUri=o.silentCheckSsoRedirectUri),o.pkceMethod){if("S256"!==o.pkceMethod)throw"Invalid value for pkceMethod";l.pkceMethod=o.pkceMethod}}l.responseMode||(l.responseMode="fragment"),l.responseType||(l.responseType="code",l.flow="standard");var t=b(!1),i=b(!0);i.promise.success(function(){l.onReady&&l.onReady(l.authenticated),t.setSuccess(l.authenticated)}).error(function(e){t.setError(e)});var e=function(){var e,t=b(!0);function r(e){l.endpoints=e?{authorize:function(){return e.authorization_endpoint},token:function(){return e.token_endpoint},logout:function(){if(!e.end_session_endpoint)throw"Not supported by the OIDC server";return e.end_session_endpoint},checkSessionIframe:function(){if(!e.check_session_iframe)throw"Not supported by the OIDC server";return e.check_session_iframe},register:function(){throw'Redirection to "Register user" page not supported in standard OIDC mode'},userinfo:function(){if(!e.userinfo_endpoint)throw"Not supported by the OIDC server";return e.userinfo_endpoint}}:{authorize:function(){return m()+"/protocol/openid-connect/auth"},token:function(){return m()+"/protocol/openid-connect/token"},logout:function(){return m()+"/protocol/openid-connect/logout"},checkSessionIframe:function(){var e=m()+"/protocol/openid-connect/login-status-iframe.html";return l.iframeVersion&&(e=e+"?version="+l.iframeVersion),e},register:function(){return m()+"/protocol/openid-connect/registrations"},userinfo:function(){return m()+"/protocol/openid-connect/userinfo"}}}if(c?"string"==typeof c&&(e=c):e="keycloak.json",e)(i=new XMLHttpRequest).open("GET",e,!0),i.setRequestHeader("Accept","application/json"),i.onreadystatechange=function(){if(4==i.readyState)if(200==i.status||v(i)){var e=JSON.parse(i.responseText);l.authServerUrl=e["auth-server-url"],l.realm=e.realm,l.clientId=e.resource,l.clientSecret=(e.credentials||{}).secret,r(null),t.setSuccess()}else t.setError()},i.send();else{if(!c.clientId)throw"clientId missing";l.clientId=c.clientId,l.clientSecret=(c.credentials||{}).secret;var n=c.oidcProvider;if(n){var o,i;"string"==typeof n?(o="/"==n.charAt(n.length-1)?n+".well-known/openid-configuration":n+"/.well-known/openid-configuration",(i=new XMLHttpRequest).open("GET",o,!0),i.setRequestHeader("Accept","application/json"),i.onreadystatechange=function(){4==i.readyState&&(200==i.status||v(i)?(r(JSON.parse(i.responseText)),t.setSuccess()):t.setError())},i.send()):(r(n),t.setSuccess())}else{if(!c.url)for(var s=document.getElementsByTagName("script"),a=0;a<s.length;a++)if(s[a].src.match(/.*keycloak\.js/)){c.url=s[a].src.substr(0,s[a].src.indexOf("/js/keycloak.js"));break}if(!c.realm)throw"realm missing";l.authServerUrl=c.url,l.realm=c.realm,r(null),t.setSuccess()}}return t.promise}();function r(){function t(e){e||(n.prompt="none"),l.login(n).success(function(){i.setSuccess()}).error(function(){i.setError()})}function r(){var t=document.createElement("iframe"),e=l.createLoginUrl({prompt:"none",redirectUri:l.silentCheckSsoRedirectUri});t.setAttribute("src",e),t.setAttribute("title","keycloak-silent-check-sso"),t.style.display="none",document.body.appendChild(t);var r=function(e){e.origin===window.location.origin&&t.contentWindow===e.source&&(k(y(e.data),i),document.body.removeChild(t),window.removeEventListener("message",r))};window.addEventListener("message",r)}var n={};switch(o.onLoad){case"check-sso":f.enable?S().success(function(){U().success(function(e){e?i.setSuccess():l.silentCheckSsoRedirectUri?r():t(!1)}).error(function(){i.setError()})}):l.silentCheckSsoRedirectUri?r():t(!1);break;case"login-required":t(!0);break;default:throw"Invalid value for onLoad"}}return e.success(function(){var e=y(window.location.href);if(e&&window.history.replaceState(window.history.state,null,e.newUrl),e&&e.valid)return S().success(function(){k(e,i)}).error(function(e){i.setError()});o?o.token&&o.refreshToken?(w(o.token,o.refreshToken,o.idToken),f.enable?S().success(function(){U().success(function(e){e?(l.onAuthSuccess&&l.onAuthSuccess(),i.setSuccess(),A()):i.setSuccess()}).error(function(){i.setError()})}):l.updateToken(-1).success(function(){l.onAuthSuccess&&l.onAuthSuccess(),i.setSuccess()}).error(function(){l.onAuthError&&l.onAuthError(),o.onLoad?r():i.setError()})):o.onLoad?r():i.setSuccess():i.setSuccess()}),e.error(function(){t.setError()}),t.promise},l.login=function(e){return u.login(e)},l.createLoginUrl=function(e){var t,r,n=g(),o=g(),i=u.redirectUri(e),s={state:n,nonce:o,redirectUri:encodeURIComponent(i)};e&&e.prompt&&(s.prompt=e.prompt),t=e&&"register"==e.action?l.endpoints.register():l.endpoints.authorize(),r=e&&e.scope?-1!=e.scope.indexOf("openid")?e.scope:"openid "+e.scope:"openid";var a=t+"?client_id="+encodeURIComponent(l.clientId)+"&redirect_uri="+encodeURIComponent(i)+"&state="+encodeURIComponent(n)+"&response_mode="+encodeURIComponent(l.responseMode)+"&response_type="+encodeURIComponent(l.responseType)+"&scope="+encodeURIComponent(r);if(h&&(a=a+"&nonce="+encodeURIComponent(o)),e&&e.prompt&&(a+="&prompt="+encodeURIComponent(e.prompt)),e&&e.maxAge&&(a+="&max_age="+encodeURIComponent(e.maxAge)),e&&e.loginHint&&(a+="&login_hint="+encodeURIComponent(e.loginHint)),e&&e.idpHint&&(a+="&kc_idp_hint="+encodeURIComponent(e.idpHint)),e&&e.locale&&(a+="&ui_locales="+encodeURIComponent(e.locale)),e&&e.kcLocale&&(a+="&kc_locale="+encodeURIComponent(e.kcLocale)),l.pkceMethod){var c=function(e){return p(e,"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789")}(96);s.pkceCodeVerifier=c,a+="&code_challenge="+function(e,t){switch(e){case"S256":var r=new Uint8Array(I.arrayBuffer(t));return E.fromByteArray(r).replace(/\+/g,"-").replace(/\//g,"_").replace(/\=/g,"");default:throw"Invalid value for pkceMethod"}}(l.pkceMethod,c),a+="&code_challenge_method="+l.pkceMethod}return d.add(s),a},l.logout=function(e){return u.logout(e)},l.createLogoutUrl=function(e){return l.endpoints.logout()+"?redirect_uri="+encodeURIComponent(u.redirectUri(e,!1))},l.register=function(e){return u.register(e)},l.createRegisterUrl=function(e){return(e=e||{}).action="register",l.createLoginUrl(e)},l.createAccountUrl=function(e){var t=m(),r=void 0;return void 0!==t&&(r=t+"/account?referrer="+encodeURIComponent(l.clientId)+"&referrer_uri="+encodeURIComponent(u.redirectUri(e))),r},l.accountManagement=function(){return u.accountManagement()},l.hasRealmRole=function(e){var t=l.realmAccess;return!!t&&0<=t.roles.indexOf(e)},l.hasResourceRole=function(e,t){if(!l.resourceAccess)return!1;var r=l.resourceAccess[t||l.clientId];return!!r&&0<=r.roles.indexOf(e)},l.loadUserProfile=function(){var e=m()+"/account",t=new XMLHttpRequest;t.open("GET",e,!0),t.setRequestHeader("Accept","application/json"),t.setRequestHeader("Authorization","bearer "+l.token);var r=b(!1);return t.onreadystatechange=function(){4==t.readyState&&(200==t.status?(l.profile=JSON.parse(t.responseText),r.setSuccess(l.profile)):r.setError())},t.send(),r.promise},l.loadUserInfo=function(){var e=l.endpoints.userinfo(),t=new XMLHttpRequest;t.open("GET",e,!0),t.setRequestHeader("Accept","application/json"),t.setRequestHeader("Authorization","bearer "+l.token);var r=b(!1);return t.onreadystatechange=function(){4==t.readyState&&(200==t.status?(l.userInfo=JSON.parse(t.responseText),r.setSuccess(l.userInfo)):r.setError())},t.send(),r.promise},l.isTokenExpired=function(e){if(!l.tokenParsed||!l.refreshToken&&"implicit"!=l.flow)throw"Not authenticated";if(null==l.timeSkew)return console.info("[KEYCLOAK] Unable to determine if token is expired as timeskew is not set"),!0;var t=l.tokenParsed.exp-Math.ceil((new Date).getTime()/1e3)+l.timeSkew;if(e){if(isNaN(e))throw"Invalid minValidity";t-=e}return t<0},l.updateToken=function(i){var s=b(!1);if(!l.refreshToken)return s.setError(),s.promise;function e(){var e=!1;if(-1==i?(e=!0,console.info("[KEYCLOAK] Refreshing token: forced refresh")):l.tokenParsed&&!l.isTokenExpired(i)||(e=!0,console.info("[KEYCLOAK] Refreshing token: token expired")),e){var t="grant_type=refresh_token&refresh_token="+l.refreshToken,r=l.endpoints.token();if(a.push(s),1==a.length){var n=new XMLHttpRequest;n.open("POST",r,!0),n.setRequestHeader("Content-type","application/x-www-form-urlencoded"),n.withCredentials=!0,l.clientId&&l.clientSecret?n.setRequestHeader("Authorization","Basic "+btoa(l.clientId+":"+l.clientSecret)):t+="&client_id="+encodeURIComponent(l.clientId);var o=(new Date).getTime();n.onreadystatechange=function(){if(4==n.readyState)if(200==n.status){console.info("[KEYCLOAK] Token refreshed"),o=(o+(new Date).getTime())/2;var e=JSON.parse(n.responseText);w(e.access_token,e.refresh_token,e.id_token,o),l.onAuthRefreshSuccess&&l.onAuthRefreshSuccess();for(var t=a.pop();null!=t;t=a.pop())t.setSuccess(!0)}else for(console.warn("[KEYCLOAK] Failed to refresh token"),400==n.status&&l.clearToken(),l.onAuthRefreshError&&l.onAuthRefreshError(),t=a.pop();null!=t;t=a.pop())t.setError(!0)},n.send(t)}}else s.setSuccess(!1)}return i=i||5,f.enable?U().success(function(){e()}).error(function(){s.setError()}):e(),s.promise},l.clearToken=function(){l.token&&(w(null,null,null),l.onAuthLogout&&l.onAuthLogout(),l.loginRequired&&l.login())},l.callback_id=0;var _=function(){if(!(this instanceof _))return new _;function n(){for(var e=(new Date).getTime(),t=0;t<localStorage.length;t++){var r=localStorage.key(t);if(r&&0==r.indexOf("kc-callback-")){var n=localStorage.getItem(r);if(n)try{var o=JSON.parse(n).expires;(!o||o<e)&&localStorage.removeItem(r)}catch(e){localStorage.removeItem(r)}}}}localStorage.setItem("kc-test","test"),localStorage.removeItem("kc-test"),this.get=function(e){if(e){var t="kc-callback-"+e,r=localStorage.getItem(t);return r&&(localStorage.removeItem(t),r=JSON.parse(r)),n(),r}},this.add=function(e){n();var t="kc-callback-"+e.state;e.expires=(new Date).getTime()+36e5,localStorage.setItem(t,JSON.stringify(e))}},C=function(){if(!(this instanceof C))return new C;this.get=function(e){if(e){var t=n("kc-callback-"+e);return o("kc-callback-"+e,"",r(-100)),t?JSON.parse(t):void 0}},this.add=function(e){o("kc-callback-"+e.state,JSON.stringify(e),r(60))},this.removeItem=function(e){o(e,"",r(-100))};var r=function(e){var t=new Date;return t.setTime(t.getTime()+60*e*1e3),t},n=function(e){for(var t=e+"=",r=document.cookie.split(";"),n=0;n<r.length;n++){for(var o=r[n];" "==o.charAt(0);)o=o.substring(1);if(0==o.indexOf(t))return o.substring(t.length,o.length)}return""},o=function(e,t,r){var n=e+"="+t+"; expires="+r.toUTCString()+"; ";document.cookie=n}}}});
//# sourceMappingURL=dist/keycloak.min.js.map